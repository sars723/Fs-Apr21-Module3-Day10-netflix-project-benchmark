<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />

    <title>Strive CRUD Agenda</title>
    <style>
      body {
        background-color: #010101;
        color: white;
      }
      .navBar {
        background-color: rgb(14, 14, 14);
        max-height: 60px;
      }
      .tvGenres {
        margin-left: 0px;
        padding-top: 20px;
      }

      .genresButton {
        color: rgb(255, 255, 255);
        background-color: rgb(14, 14, 14);
      }

      body {
        background-color: rgb(14, 14, 14);
      }

      .tvText {
        color: white;
      }
      .viewButton {
        color: rgb(255, 255, 255);
        background-color: rgb(14, 14, 14);
        max-height: 30px;
        padding-top: 0;
      }
      .carousel-item img {
        opacity: 0.7;
      }
      .carousel-item img:hover {
        transform: scale(1.2);
        opacity: 1;
        transition: 0.3s;
        cursor: pointer;
      }
      .serviceCode {
        color: rgb(255, 255, 255);
        background-color: rgb(14, 14, 14);
        margin-bottom: 15px;
      }
      li {
        list-style: none;
      }
      a {
        color: white;
      }
      .avatarDrop {
        border: none;
      }
      footer li {
        margin-bottom: 15px;
      }

      .carousel-control-prev,
      .carousel-control-next {
        width: max-content;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navBar navbar-dark">
      <a class="navbar-brand" href="./day5-dashboard.html">
        <img src="images/logo.png" alt="Netflix" width="110" height="20" />
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarScroll"
        aria-controls="navbarScroll"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarScroll">
        <ul
          class="navbar-nav mr-auto my-2 my-lg-0 navbar-nav-scroll"
          style="max-height: 100px"
        >
          <li class="nav-item">
            <a class="nav-link" href="/homepage.html">
              Home
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">TV Shows</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Recently Added</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My List</a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link text-white" href="#">
              <i class="fa fa-search"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Kids</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fa fa-bell"></i></a>
          </li>
        </ul>
        <div class="dropdown">
          <button
            class="
              genresButton
              btn btn-secondary
              dropdown-toggle
              ml-4
              avatarDrop
            "
            type="button genresButton"
            id="dropdownMenuButton"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <img src="images/avatar.png" alt="avatar" width="30px" />
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">Romance</a>
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Comedy</a>
            <a class="dropdown-item" href="#">Thriller</a>
          </div>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <h2 class="d-inline-block mt-5 mb-3">Backoffice</h2>
          <h5 id="subtitle" class="d-inline-block"></h5>

          <hr />

          <span id="alert-box"></span>

          <form onsubmit="handleSubmit(event)">
            <div class="form-group">
              <label for="name">Movie name</label>
              <input
                id="name"
                type="text"
                class="form-control"
                placeholder="Insert a name for the Movie"
                aria-describedby="name"
                required
              />
            </div>
            <div class="form-group">
              <label for="description">Movie description</label>
              <textarea
                id="description"
                type="text"
                rows="6"
                class="form-control"
                placeholder="Write a description for the Movie"
                aria-describedby="event description"
                required
              ></textarea>
            </div>
            <div class="form-group">
              <label for="category">Movie Category</label>
              <input
                id="category"
                type="text"
                class="form-control"
                placeholder="Insert a brand for the Movie"
                aria-describedby="name"
                required
              />
            </div>
            <div class="form-group">
              <label for="image-url">imageUrl</label>
              <input
                id="image-url"
                type="text"
                class="form-control"
                placeholder="Insert image url for the Movie"
                aria-describedby="name"
                required
              />
            </div>
            <div class="d-flex justify-content-between">
              <button type="submit" class="btn btn-primary">
                Submit
                <div
                  id="spinner"
                  class="spinner-border spinner-border-sm d-none"
                  role="status"
                >
                  <span class="sr-only">Loading...</span>
                </div>
              </button>
              <button
                id="delete-btn"
                type="button"
                class="btn btn-danger d-none"
                onclick="handleDelete()"
              >
                <ion-icon name="trash-outline"></ion-icon>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <footer
      class="pt-4 pb-0 mb-0 my-md-5 pt-md-5 container"
      style="width: 60vw"
    >
      <div class="row">
        <div class="col mb-3">
          <a href="https://www.facebook.com/netflix">
            <i
              class="fa fa-facebook-square"
              style="font-size: 23px; color: darkgray; margin-right: 15px"
            ></i>
          </a>
          <a href="https://twitter.com/netflixuk?lang=en">
            <i
              class="fa fa-twitter-square"
              style="font-size: 23px; color: darkgray; margin-right: 15px"
            ></i>
          </a>
          <a href="https://www.snapchat.com/add/netflix">
            <i
              class="fa fa-snapchat-square"
              style="font-size: 23px; color: darkgray; margin-right: 15px"
            ></i>
          </a>
          <a href="https://www.youtube.com/channel/UCWOA1ZGywLbqmigxE4Qlvuw">
            <i
              class="fa fa-youtube"
              style="font-size: 23px; color: darkgray; margin-right: 15px"
            ></i>
          </a>
        </div>
      </div>
      <div class="row">
        <div class="col-6 col-md">
          <ul class="list-unstyled text-small">
            <li><a class="text-muted" href="#">Media Centre</a></li>
            <li><a class="text-muted" href="#">Privacy</a></li>
            <li><a class="text-muted" href="#">Audio and Subtitles</a></li>
            <li><a class="text-muted" href="#">Investor Relations</a></li>
          </ul>
        </div>
        <div class="col-6 col-md">
          <ul class="list-unstyled text-small">
            <li><a class="text-muted" href="#">Help Centre</a></li>
            <li><a class="text-muted" href="#">Jobs</a></li>
            <li><a class="text-muted" href="#">Terms of Use</a></li>
          </ul>
        </div>
        <div class="col-6 col-md">
          <ul class="list-unstyled text-small">
            <li><a class="text-muted" href="#">Buy gift cards</a></li>
            <li><a class="text-muted" href="#">Netflix Originals</a></li>
            <li><a class="text-muted" href="#">Legal Notices</a></li>
          </ul>
        </div>
        <div class="col-6 col-md">
          <ul class="list-unstyled text-small">
            <li><a class="text-muted" href="#">Cookie Preferences</a></li>
            <li><a class="text-muted" href="#">Account</a></li>
            <li><a class="text-muted" href="#">FAQ</a></li>
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button type="button" class="btn btn-secondary serviceCode">
            Service Code
          </button>
        </div>
      </div>
      <div class="row">
        <div class="col">Â©1997-2021 Netflix Inc. {0x884eb88f4e}</div>
      </div>
    </footer>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      let movieId = urlParams.get("id");

      const endpoint = movieId
        ? "https://striveschool-api.herokuapp.com/api/movies/ " + movieId
        : "https://striveschool-api.herokuapp.com/api/movies/ ";

      const method = movieId ? "PUT" : "POST";

      window.onload = async () => {
        console.log("Resource ID: ", movieId);

        if (movieId) {
          const response = await fetch(endpoint, {
            headers: {
              Authorization:
                "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MGFlM2YzMGNlYWY0ODAwMTVjOTE4NjkiLCJpYXQiOjE2MjIxODY0MDMsImV4cCI6MTYyMzM5NjAwM30.q_Xe3H8WBkgretPhe9yiH7ITCKNQku72ZoLejeiaYOc",
            },
          });
          const movieDetails = await response.json();
          console.log(movieDetails);

          document.getElementById("delete-btn").classList.remove("d-none");

          populateFields(movieDetails);
        } else {
        }
      };

      const objModel = {
        name: "",
        description: "",
        category: "",
        imageUrl: "",
      };

      const populateFields = (obj = objModel) => {
        document.getElementById("name").value = obj.name;
        document.getElementById("description").value = obj.description;
        document.getElementById("category").value = obj.category;
        document.getElementById("image-url").value = obj.imageUrl;
      };

      const handleSubmit = async (event) => {
        event.preventDefault();

        isLoading(true);

        /*    let category = []; */

        const movie = {
          name: document.getElementById("name").value,
          description: document.getElementById("description").value,
          category: document.getElementById("category").value,
          imageUrl: document.getElementById("image-url").value,
        };

        try {
          const response = await fetch(endpoint, {
            method,
            body: JSON.stringify(movie),
            headers: {
              Authorization:
                "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MGFlM2YzMGNlYWY0ODAwMTVjOTE4NjkiLCJpYXQiOjE2MjIxODY0MDMsImV4cCI6MTYyMzM5NjAwM30.q_Xe3H8WBkgretPhe9yiH7ITCKNQku72ZoLejeiaYOc",
              "Content-Type": "application/json",
            },
          });
        } catch (err) {
          alert(err.message);
        }
        isLoading(false);
      };
      const isLoading = (loading) => {
        // toggles the submit button loader on/off
        if (loading) {
          document.getElementById("spinner").classList.remove("d-none");
        } else {
          document.getElementById("spinner").classList.add("d-none");
        }
      };
      //delete
      const handleDelete = async () => {
        try {
          const response = await fetch(endpoint, { method: "DELETE" });
          if (response.ok) {
            alert("Event deleted successfully");
            window.location.assign("./homepage.html");
          } else {
            alert("something went wrong with the deletion process");
          }
        } catch (error) {
          console.log(error.message);
        }
      };
    </script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/ionicons@5.4.0/dist/ionicons.js"></script>
  </body>
</html>
